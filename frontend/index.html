<html>
    <head>
        <script crossorigin src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
        <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
        <script src="scripts/components.js"></script>
        <script src="scripts/index.js"></script>
        <script src="scripts/nodes.js"></script>
        <script>

            function allowDrop(ev) {
            ev.preventDefault();
            }

            function drag(ev) {
                ev.dataTransfer.setData("text", ev.target.id.replace("node-root-",""));
            }

            function drop(ev) {
                ev.preventDefault();

                const components = ev.target.id.split("node-");
                const node = "node-"+components.slice(-1);

                var data = ev.dataTransfer.getData("text");
                addChild(data,node);

                document.getElementById("node").innerHTML = generateNode(me);
            }
    
        </script>
    </head>
    <body>
        <div id="node"></div>
        <script src="https://d3js.org/d3.v3.min.js"></script>
        <script>
            const me = addNode("Rob","me");

            let city = addNode("Vancouver","location");
            addChild(city,me);

                let job = addNode("DMG","income");
                addChild(job,city);

                    let transportation = addNode("Transportation","expense");
                    addChild(transportation,job);
                    addChild(addNode("Transit","expense"),transportation);

                    let car = addNode("Car","expense");
                    addChild(car,transportation);
                    addChild(addNode("Civic","expense"),car);
                    addChild(addNode("Toyota - Rav4","expense"),car);
                    addChild(addNode("Lexus - NX300","expense"),car);


                job = addNode("Fortinet","income");
                addChild(job,city);

                    transportation = addNode("Transportation","expense");
                    addChild(transportation,job);

                    car = addNode("Car","expense");
                    addChild(car,transportation);
                    addChild(addNode("Civic","expense"),car);
                    addChild(addNode("Toyota - Rav4","expense"),car);

                job = addNode("Sophos","income");
                addChild(job,city);

                    transportation = addNode("Transportation","expense");
                    addChild(transportation,job);
                    addChild(addNode("Transit","expense"),transportation);

                    car = addNode("Car","expense");
                    addChild(car,transportation);
                    addChild(addNode("Civic","expense"),car);

            city = addNode("New York","location");
            addChild(city,me);

                job = addNode("MasterCard","income");
                addChild(job,city);

                    transportation = addNode("Transportation","expense");
                    addChild(transportation,job);
                    addChild(addNode("Transit","expense"),transportation);
                    addChild(addNode("Uber","expense"),transportation);

            let level = 0;
            var canvas = d3.select("body").append("svg")
                .attr("width","100%")
                .attr("height","100%")
                .append("g")
                .attr("transform","translate(50,50)");

            var treechart = d3.layout.tree()
                .size([1200,800]);

            var _nodes = treechart.nodes(traverse(me));
            var links = treechart.links(_nodes);

            console.log(_nodes);
            console.log(links);

            var diagonal = d3.svg.diagonal()
                .projection((d)=> {return [d.y,d.x];})

            canvas.selectAll(".link")
                .data(links)
                .enter()
                .append("line")
                .attr("class","link")
                .attr("fill","none")
                .attr("stroke","steelblue")
                .attr("stroke-width",4)
                .attr("x1",(d) => {return d.source.y;})
                .attr("y1",(d) => {return d.source.x;})
                .attr("x2",(d) => {return d.target.y;})
                .attr("y2",(d) => {return d.target.x;})

            var node = canvas.selectAll(".node")
                .data(_nodes)
                .enter()
                .append("g")
                .attr("class","node")
                .attr("transform", (d)=>{return `translate (${d.y},${d.x})`});

            node.append("circle")
                .attr("r",40)
                .attr("fill","white")
                .attr("stroke","steelblue")
                .attr("stroke-width",4)

            node.append("circle")
                .attr("r",15)
                .attr("fill","grey")
                .attr("stroke","steelblue")
                .attr("stroke-width",4)
                .attr("cx","30")
                .attr("cy","-30")

            node.append("text")
                .text((d)=>{return `${d.name}`})
                .attr("text-anchor","middle")
                .attr("y",5);
        </script>
    </body>
</html>
